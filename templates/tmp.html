<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <link rel="shortcut icon" href="{{ url_for('static', filename='imgs/favicon.ico') }}">
    <title>Url Hit</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/index.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/semantic.min.css') }}">
    <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
    <script src="{{ url_for('static', filename='js/semantic.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/Chart.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/utils.js') }}"></script>
    <style>
        canvas {
            -moz-user-select: none;
            -webkit-user-select: none;
            -ms-user-select: none;
        }

        .chart-container {
            width: 600px;
            margin: 40px;
        }

        .container {
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
            justify-content: center;
        }
    </style>
</head>

<body>
    <div class="ui overlay visible left vertical inverted sidebar menu default">
        <div class="menu top">
            <img src="{{ url_for('static', filename='imgs/punch.png') }}" width="64">
        </div>
        <div class="menu top">
            <h3 class="ui header white">UrlHit</h3>
        </div>
        <a class="item" href="/">
            <div class="ui header white">
                <i class="home icon size-a">
                </i>
                Home
            </div>
        </a>
        <a class="item" href="/apply">
            <div class="ui header white">
                <i class="edit icon size-a">
                </i>
                Apply
            </div>
        </a>
    </div>
    <div class="pusher">
        <div class="content top">
            <h1 class="ui header">Home</h1>
        </div>
        <div class="content mid">
            <div class="ui grid" id="list-header">
            </div>
            <div class="ui grid" id="list-header2">
            </div>
            <div class="container">
            </div>
            <script>
                const colorSet = ["#cd6155", "#af7ac5", "#5499c7", "#48c9b0", "#52be80", "#f4d03f", "#eb984e", "#f0f3f4", "#aab7b8", "#5d6d7e", "#ec7063", "#a569bd", "#5dade2", "#45b39d", "#58d68d", "#f5b041", "#dc7633", "#cacfd2", "#99a3a4", "#566573", "#d98880", "#c39bd3", "#7fb3d5", "#76d7c4", "#7dcea0", "#f7dc6f", "#f0b27a", "#f4f6f7", "#bfc9ca", "#85929e", "#f1948a", "#bb8fce", "#85c1e9", "#73c6b6", "#82e0aa", "#f8c471", "#e59866", "#d7dbdd", "#b2babb", "#808b96", "#e6b0aa", "#d7bde2", "#a9cce3", "#a3e4d7", "#a9dfbf", "#f9e79f", "#f5cba7", "#f7f9f9", "#d5dbdb", "#aeb6bf", "#f5b7b1", "#d2b4de", "#aed6f1", "#a2d9ce", "#abebc6", "#fad7a0", "#edbb99", "#e5e7e9", "#ccd1d1", "#abb2b9", "#f2d7d5", "#ebdef0", "#d4e6f1", "#d1f2eb", "#d4efdf", "#fcf3cf", "#fae5d3", "#fbfcfc", "#eaeded", "#d6dbdf", "#fadbd8", "#e8daef", "#d6eaf8", "#d0ece7", "#d5f5e3", "#fdebd0", "#f6ddcc", "#f2f3f4", "#e5e8e8", "#d5d8dc", "#f9ebea", "#f5eef8", "#eaf2f8", "#e8f8f5", "#e9f7ef", "#fef9e7", "#fdf2e9", "#fdfefe", "#f4f6f6", "#ebedef", "#fdedec", "#f4ecf7", "#ebf5fb", "#e8f6f3", "#eafaf1", "#fef5e7", "#fbeee6", "#f8f9f9", "#f2f4f4", "#eaecee", "#641e16", "#512e5f", "#154360", "#0e6251", "#145a32", "#7d6608", "#784212", "#7b7d7d", "#4d5656", "#1b2631", "#78281f", "#4a235a", "#1b4f72", "#0b5345", "#186a3b", "#7e5109", "#6e2c00", "#626567", "#424949", "#17202a", "#7b241c", "#633974", "#1a5276", "#117864", "#196f3d", "#9a7d0a", "#935116", "#979a9a", "#5f6a6a", "#212f3c", "#943126", "#5b2c6f", "#21618c", "#0e6655", "#1d8348", "#9c640c", "#873600", "#797d7f", "#515a5a", "#1c2833", "#922b21", "#76448a", "#1f618d", "#148f77", "#1e8449", "#b7950b", "#af601a", "#b3b6b7", "#717d7e", "#283747", "#b03a2e", "#6c3483", "#2874a6", "#117a65", "#239b56", "#b9770e", "#a04000", "#909497", "#616a6b", "#212f3d", "#a93226", "#884ea0", "#2471a3", "#17a589", "#229954", "#d4ac0d", "#ca6f1e", "#d0d3d4", "#839192", "#2e4053", "#cb4335", "#7d3c98", "#2e86c1", "#138d75", "#28b463", "#d68910", "#ba4a00", "#a6acaf", "#707b7c", "#273746", "#c0392b", "#9b59b6", "#2980b9", "#1abc9c", "#27ae60", "#f1c40f", "#e67e22", "#ecf0f1", "#95a5a6", "#34495e", "#e74c3c", "#8e44ad", "#3498db", "#16a085", "#2ecc71", "#f39c12", "#d35400", "#bdc3c7", "#7f8c8d", "#2c3e50"];

                function CirclePieConfig(labels, data) {
                    const _colorSet = [];
                    for(var i = 0; i<labels.length; i++)
                        _colorSet.push(colorSet[parseInt(Math.random() * 200) + 1]);
                    return {
                        type: "pie",
                        data: {
                            labels: labels,
                            datasets: [{
                                label: '',
                                data: data,
                                backgroundColor: _colorSet,
                                borderWidth: 1,
                                pointStyle: 'rectRot',
                                pointRadius: 5,
                                pointBorderColor: 'rgb(0, 0, 0)'
                            }]
                        },
                        options: {
                            responsive: true,
                            legend: {
                                labels: {
                                    usePointStyle: false
                                }
                            },
                            scales: {
                                x: {
                                    display: true,
                                    scaleLabel: {
                                        display: true,
                                        labelString: 'UrlRoot'
                                    }
                                },
                                y: {
                                    display: true,
                                    scaleLabel: {
                                        display: true,
                                        labelString: 'Value'
                                    }
                                }
                            },
                            title: {
                                display: true,
                                text: 'Normal Legend'
                            }
                        }
                    };
                };

                function createPointStyleConfig(title, labels, data) {
                    var config;
                    config = CirclePieConfig(labels, data);
                    config.options.legend.labels.usePointStyle = true;
                    config.options.title.text = title;
                    return config;
                };
                window.onload = function() {
                    const _data = [];
                    const labelList = [];
                    const dataList = [];
                    const shortUrlList = [];
                    $.ajax({
                        type: "POST",
                        url: "/",
                        dataType: "json",
                        contentType: "application/json",
                        data: JSON.stringify(_data),
                        success: function(result) {
                            var canvasList = [];
                            for (var i = 1; i <= result.urlCount; i++)
                                $(".container").append('<div class="chart-container"><canvas id="canvas' + i + '"></canvas></div>');
                            if (result.Code == 200) {
                                for (var i = 1; i <= result.urlCount; i++) {
                                    shortUrlList.push(Object.values(result.urls[i].shortulrs));
                                    labelList.push(Object.keys(result.urls[i].tags));
                                    dataList.push(Object.values(result.urls[i].tags));
                                    canvasList.push({
                                        id: 'canvas' + i,
                                        config: createPointStyleConfig(result.urls[i].url, labelList[i - 1], dataList[i - 1])
                                    })
                                }
                            }
                            
                            canvasList.forEach(function(details) {
                                var ctx = document.getElementById(details.id).getContext('2d');
                                new Chart(ctx, details.config);
                            });
                            
                            for (var i = 1; i <= result.urlCount; i++) {
                                $("#list-header2").append('<div class="row"><div class="six wide column"><h2 class="ui header">' + result.urls[i].url + '</h2></div><div class="middle aligned ten wide column" id="list-labels' + i + '" style="overflow-x: auto; overflow-y:hidden; white-space:nowrap;"></div></div>');
                                for (var j = 1; j <= Object.keys(result.urls[i].shortulrs).length; j++) {
                                    $("#list-header").append('<div class="row"style="margin-left: 100px; margin-right: 100px;"><div class="middle aligned four wide column"style="background: #d98880;">' + Object.keys(result.urls[i].tags)[j - 1] + '</div><a class="middle aligned twelve wide column"style="background: #c39bd3;font-size:20px;" href="https://urlhit.run.goorm.io/url/' + Object.values(result.urls[i].shortulrs)[j - 1] + '">https://urlhit.run.goorm.io/url/' + Object.values(result.urls[i].shortulrs)[j - 1] + '</a><div class="sixteen wide column"style="background: #7fb3d5;">' + result.urls[i].url + '</div></div>');
                                    // $("#list-labels"+i).append('<a class="ui tag label" style="margin-right: 10px;margin-left: 10px;background:'+ colorSet[parseInt(Math.random() * 200) + 1] +';" href="https://urlhit.run.goorm.io/url/' + Object.values(result.urls[i].shortulrs)[j-1] + '">' + Object.keys(result.urls[i].tags)[j-1] + '</a>');
                                    $("#list-labels" + i).append('<button class="ui button "style="margin-right: 10px;margin-left: 10px;background:' + colorSet[parseInt(Math.random() * 200) + 1] + ';" onClick = "location.href="https://urlhit.run.goorm.io/url/' + Object.values(result.urls[i].shortulrs)[j - 1] + '">' + Object.keys(result.urls[i].tags)[j - 1] + '</button>');
                                }
                            }
                        },
                        error: function(xhr, status, error) {
                            console.log(error);
                        }
                    });
                };
            </script>
        </div>
    </div>

</body>

</html>