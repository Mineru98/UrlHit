<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <link rel="shortcut icon" href="{{ url_for('static', filename='imgs/favicon.ico') }}">
    <title>Url Hit</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/index.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/semantic.min.css') }}">
    <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
    <script src="{{ url_for('static', filename='js/semantic.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/Chart.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/utils.js') }}"></script>
    <style>
        canvas {
            -moz-user-select: none;
            -webkit-user-select: none;
            -ms-user-select: none;
        }

        .chart-container {
            width: 600px;
            margin-left: 40px;
            margin-right: 40px;
        }

        .container {
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
            justify-content: center;
        }
    </style>
</head>

<body>
    <div class="ui overlay visible left vertical inverted sidebar menu default">
        <div class="menu top">
            <img src="{{ url_for('static', filename='imgs/punch.png') }}" width="64">
        </div>
        <div class="menu top">
            <h3 class="ui header white">UrlHit</h3>
        </div>
        <a class="item" href="/">
            <div class="ui header white">
                <i class="home icon size-a">
                </i>
                Home
            </div>
        </a>
        <a class="item" href="/apply">
            <div class="ui header white">
                <i class="edit icon size-a">
                </i>
                Apply
            </div>
        </a>
    </div>
    <div class="pusher">
        <div class="content top">
            <h1 class="ui header">Home</h1>
        </div>
        <div class="content mid">
            <div class="container">
                <div class="chart-container">
                    <canvas id="canvas"></canvas>
                </div>
                <div class="chart-container">
                    <canvas id="canvas2"></canvas>
                </div>
                <div class="chart-container">
                    <canvas id="canvas3"></canvas>
                </div>
                <div class="chart-container">
                    <canvas id="canvas4"></canvas>
                </div>
            </div>
            <script>
                var color = Chart.helpers.color;
                function createConfig(colorName, labels, data) {
                    return {
                        type: "pie",
                        data: {
                            labels: labels,
                            datasets: [{
                                label: 'My First dataset',
                                data: data,
                                backgroundColor: [
                                    window.chartColors.blue,
                                    window.chartColors.green,
                                    window.chartColors.red,
                                ],
                                borderWidth: 1,
                                pointStyle: 'rectRot',
                                pointRadius: 5,
                                pointBorderColor: 'rgb(0, 0, 0)'
                            }]
                        },
                        options: {
                            responsive: true,
                            legend: {
                                labels: {
                                    usePointStyle: false
                                }
                            },
                            scales: {
                                x: {
                                    display: true,
                                    scaleLabel: {
                                        display: true,
                                        labelString: 'UrlRoot'
                                    }
                                },
                                y: {
                                    display: true,
                                    scaleLabel: {
                                        display: true,
                                        labelString: 'Value'
                                    }
                                }
                            },
                            title: {
                                display: true,
                                text: 'Normal Legend'
                            }
                        }
                    };
                }

                function createPointStyleConfig(colorName, title = 'UrlHit', labels = [], data = []) {
                    var config;
                    config = createConfig(colorName, labels, data);
                    config.options.legend.labels.usePointStyle = true;
                    config.options.title.text = title;
                    return config;
                }
                window.onload = function() {
                    const _data = [];
                    var labelList = [];
                    var dataList = [];
                    var urlList = [];
                    $.ajax({
                        type: "POST",
                        url: "/",
                        dataType: "json",
                        contentType: "application/json",
                        data: JSON.stringify(_data),
                        success: function(result) {
                            if (result.Code == 200) {
                                for (var i = 1; i <= result.size; i++) {
                                    labelList.push(result.tags[i]);
                                    urlList.push(result.urls[i]);
                                    dataList.push(result.hitcount[i])
                                }
                            }
                            const canvasList = [{
                                id: 'canvas',
                                config: createPointStyleConfig('blue', 'UrlHit Tag', labelList, dataList)
                            }, {
                                id: 'canvas2',
                                config: createPointStyleConfig('red', 'UrlHit URL', urlList, dataList)
                            }];
                            canvasList.forEach(function(details) {
                                var ctx = document.getElementById(details.id).getContext('2d');
                                new Chart(ctx, details.config);
                            });
                        },
                        error: function(xhr, status, error) {
                            console.log(error);
                        }
                    });
                };
            </script>
        </div>
    </div>

</body>

</html>